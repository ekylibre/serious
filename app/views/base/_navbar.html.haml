%nav.navbar.navbar-inverse.navbar-fixed-top
  .container-fluid
    .navbar-header
      = link_to('Game of Farms', root_url, class: 'navbar-brand')
    .collapse.navbar-collapse
      - if current_user
        - if current_user.administrator?
          %ul.nav.navbar-nav
            - [:scenarios, :games, :users].each do |name|
              %li{class: controller_name =~ /^#{name.to_s.singularize}/ ? :active : nil}= link_to("actions.backend/#{name}.index".t, controller: "backend/#{name}".to_sym, action: :index)
        - else
          %ul.nav.navbar-nav

        %ul.nav.navbar-nav.navbar-right
          - if current_participation
            - if current_participant
              - if current_participant.is_a?(Farm)
                %li
                  = link_to("javascript: alert('Lien vers Ekylibre en cours de construction')") do
                    %i.glyphicon.glyphicon-transfer
              %li
                = link_to(participant_path(current_participant)) do
                  %i.glyphicon.glyphicon-home
            %li
              = link_to(game_path(current_participation.game)) do
                %i.glyphicon.glyphicon-th
            - if turn = current_game.current_turn
              %li
                %p.navbar-text{title: turn.stopped_at.l}
                  %span.glyphicon.glyphicon-hourglass
                  = distance_of_time_in_words_to_now(turn.stopped_at)
          - if current_user
            %li.dropdown
              = link_to("#", class: "dropdown-toggle", data: {toggle: "dropdown"}, role: "button", aria: {haspopup: "true", expanded: "false"}) do
                %i.glyphicon{class: "glyphicon-#{!current_participation ? :user : current_participation.organizer? ? :king : current_participation.participant.is_a?(Farm) ? :grain : :briefcase}"}
                - if current_participant
                  = current_participant.name
                %span.caret
              %ul.dropdown-menu
                - current_user.active_games.each do |game|
                  %li.dropdown-header= game.name
                  - game.participations.where(user_id: current_user.id).sort{|a,b| a.name <=> b.name }.each do |participation|
                    - classes = []
                    - classes << :active if current_participation == participation
                    %li{class: classes}
                      = link_to(participation_path(participation)) do
                        %span.glyphicon{class: "glyphicon-#{participation.organizer? ? :king : participation.participant.is_a?(Farm) ? :grain : :briefcase}"}
                        = participation.name
                  %li.divider{role: "separator"}
                %li= link_to('Mon compte', user_path(current_user))
                %li= link_to('Se dÃ©connecter', destroy_user_session_path, method: :delete)
